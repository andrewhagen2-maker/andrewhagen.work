---
export const prerender = false;
import Base from '../layouts/Base.astro';
import ScanDashboard from '../components/ScanDashboard.astro';
import '../styles/global.css';
---

<Base
  title="Scan Dashboard — Andrew Hagen"
  description="Live scan log for the QR distribution tracking tool."
>
  <main class="page">
    <div class="container">

      <nav class="page-nav">
        <a href="/">← andrewhagen.work</a>
        <span class="nav-sep">·</span>
        <a href="/qr-generator">QR Generator</a>
      </nav>

      <header class="page-header">
        <p class="section-label">Distribution Compliance Tool</p>
        <h1 class="page-title">Scan Dashboard</h1>
        <p class="page-description">
          Every scan of a generated QR code is logged here — timestamp, distributor, country, and device.
          Data loads on page visit. Use Refresh to pull the latest.
        </p>
      </header>

      <ScanDashboard />

      <aside class="how-it-works">
        <p class="section-label">Architecture</p>
        <p>
          When a QR code is scanned, the request hits a Vercel serverless function at
          <code>andrewhagen.work/api/r/[code]</code>. The function looks up the opaque code ID
          in a private Google Sheet, writes a scan event row (timestamp, distributor, user-agent,
          country via Vercel's IP header), then immediately 302-redirects to the destination URL.
          The scanner sees only the redirect — no indication of logging. This dashboard reads
          the same Google Sheet via a separate read-only endpoint.
        </p>
      </aside>

    </div>
  </main>
</Base>

<style>
  .page {
    min-height: 100vh;
    padding: var(--space-lg) 0;
  }

  .page-nav {
    margin-bottom: var(--space-lg);
    font-size: var(--size-xs);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .page-nav a {
    color: var(--color-subtle);
  }

  .page-nav a:hover {
    color: var(--accent-1);
  }

  .nav-sep {
    color: var(--color-subtle);
    opacity: 0.4;
  }

  .page-header {
    margin-bottom: var(--space-lg);
  }

  .page-title {
    font-size: var(--size-2xl);
    font-weight: 500;
    letter-spacing: 0.03em;
    margin-bottom: var(--space-sm);
  }

  .page-description {
    font-size: var(--size-base);
    color: var(--color-subtle);
    max-width: 540px;
    line-height: 1.7;
  }

  .how-it-works {
    margin-top: var(--space-xl);
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-subtle);
    max-width: 680px;
  }

  .how-it-works p:last-child {
    font-size: var(--size-sm);
    color: var(--color-subtle);
    line-height: 1.75;
  }

  .how-it-works code {
    font-family: 'Courier New', monospace;
    font-size: 0.8em;
    color: var(--color-text);
    background: rgba(42, 39, 36, 0.08);
    padding: 0.1em 0.35em;
  }
</style>
